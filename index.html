<!doctype html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>WhiteMuse</title>
  <style>
    :root{
      --bg:#f6f7fb;
      --card:#ffffff;
      --text:#111827;
      --muted:#6b7280;
      --line:#e5e7eb;
      --brand:#6d28d9;
      --brand2:#7c3aed;
      --ok:#059669;
      --warn:#b45309;
      --err:#b91c1c;
      --shadow: 0 10px 25px rgba(17,24,39,.08);
      --radius: 18px;
      --btnradius: 12px;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --sans: system-ui, -apple-system, "Hiragino Kaku Gothic ProN", "Hiragino Sans", "Noto Sans JP", Segoe UI, Roboto, "Helvetica Neue", Arial, "Apple Color Emoji", "Segoe UI Emoji";
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:var(--sans);
      background:linear-gradient(180deg,#fff 0%, var(--bg) 70%);
      color:var(--text);
    }
    header{
      position:sticky; top:0; z-index:5;
      backdrop-filter:saturate(140%) blur(10px);
      background:rgba(255,255,255,.75);
      border-bottom:1px solid var(--line);
    }
    .wrap{max-width:1200px;margin:0 auto;padding:16px 16px 40px}
    .topbar{display:flex;align-items:center;gap:14px;justify-content:space-between}
    .brand{display:flex;align-items:center;gap:10px}
    .dot{width:10px;height:10px;border-radius:50%;background:var(--brand)}
    .title{font-weight:800;letter-spacing:.2px}
    .subtitle{font-size:12px;color:var(--muted);margin-top:2px}
    .righttools{display:flex;gap:10px;align-items:center;flex-wrap:wrap;justify-content:flex-end}
    .pill{
      display:inline-flex;align-items:center;gap:8px;
      padding:8px 12px;border-radius:999px;
      border:1px solid var(--line);
      background:#fff;
      font-size:12px;color:var(--muted);
      box-shadow:0 4px 14px rgba(17,24,39,.05);
    }
    .pill strong{color:var(--text)}
    .pill.ok{border-color:rgba(5,150,105,.25); color:var(--ok)}
    .pill.ng{border-color:rgba(185,28,28,.25); color:var(--err)}
    .btn{
      border:1px solid var(--line);
      background:#fff;
      padding:10px 12px;
      border-radius:var(--btnradius);
      cursor:pointer;
      font-weight:700;
      color:var(--text);
      box-shadow:0 6px 18px rgba(17,24,39,.06);
    }
    .btn:active{transform:translateY(1px)}
    .btn.primary{
      background:linear-gradient(135deg,var(--brand) 0%, var(--brand2) 100%);
      border-color:transparent;color:#fff;
    }
    .btn.ghost{background:#fff}
    .grid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:18px;
      margin-top:18px;
    }
    @media (max-width: 980px){
      .grid{grid-template-columns:1fr}
      .righttools{justify-content:flex-start}
    }
    .card{
      background:var(--card);
      border:1px solid var(--line);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      padding:16px;
    }
    .card h2{
      font-size:16px;margin:0 0 12px;
      display:flex;align-items:center;gap:10px
    }
    .hint{font-size:12px;color:var(--muted);font-weight:600}
    .row{display:flex;gap:12px;flex-wrap:wrap}
    .field{
      display:flex;flex-direction:column;gap:6px;
      margin-bottom:10px;
      flex:1;
      min-width: 220px;
    }
    label{font-size:12px;color:var(--muted);font-weight:700}
    input, select, textarea{
      width:100%;
      border:1px solid var(--line);
      border-radius:12px;
      padding:11px 12px;
      font-size:14px;
      outline:none;
      background:#fff;
    }
    textarea{min-height:88px;resize:vertical}
    .idbox{
      display:flex;align-items:center;justify-content:space-between;
      gap:10px;
      padding:10px 12px;
      border:1px dashed rgba(109,40,217,.35);
      background:rgba(109,40,217,.05);
      border-radius:14px;
      font-family:var(--mono);
      font-size:12px;
    }
    .actions{
      display:flex;gap:10px;flex-wrap:wrap;margin-top:10px
    }
    .seg{
      display:flex;gap:10px;flex-wrap:wrap;margin-top:10px
    }
    .seg select{max-width:240px}
    .previewGrid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:12px;
      margin-top:12px;
    }
    @media (max-width: 520px){
      .previewGrid{grid-template-columns:1fr}
    }
    .ph{
      border:1px dashed var(--line);
      border-radius:16px;
      background:linear-gradient(180deg,#fff 0%, #fafafa 100%);
      min-height:220px;
      display:flex;align-items:center;justify-content:center;
      color:var(--muted);
      position:relative;
      overflow:hidden;
    }
    .ph img{width:100%;height:100%;object-fit:contain;background:#fff}
    .ph small{
      position:absolute;top:10px;right:10px;
      background:#fff;border:1px solid var(--line);
      border-radius:999px;
      padding:6px 10px;font-size:11px;color:var(--muted);
    }
    .textout{
      margin-top:12px;
      border:1px solid var(--line);
      border-radius:14px;
      padding:12px;
      min-height:110px;
      background:#fff;
      white-space:pre-wrap;
    }
    .mini{
      font-size:12px;color:var(--muted);
      margin-top:8px;
    }
    .danger{
      margin-top:10px;
      padding:10px 12px;
      border-radius:14px;
      border:1px solid rgba(185,28,28,.25);
      background:rgba(185,28,28,.06);
      color:#7f1d1d;
      font-size:12px;
      display:none;
      white-space:pre-wrap;
    }
    .footerNote{
      margin-top:18px;
      font-size:12px;color:var(--muted)
    }
    .tinyBtns{
      display:flex;gap:10px;flex-wrap:wrap;margin-top:10px
    }
    .btn.small{padding:9px 10px;font-size:12px;border-radius:12px}
    .muted{color:var(--muted)}
    .kbd{
      font-family:var(--mono);
      border:1px solid var(--line);
      border-bottom-width:2px;
      padding:1px 6px;
      border-radius:8px;
      background:#fff;
      font-size:12px;
      color:var(--muted);
    }
  </style>
</head>
<body>
<header>
  <div class="wrap">
    <div class="topbar">
      <div class="brand">
        <div class="dot"></div>
        <div>
          <div class="title">WhiteMuse</div>
          <div class="subtitle">ç”»åƒç”Ÿæˆ / æ–‡ç« ç”Ÿæˆ / å•†å“ç®¡ç†ID / å£²ã‚ŒãŸã‚‰å–ã‚Šæ¶ˆã—ï¼ˆv1.0ï¼‰</div>
        </div>
      </div>

      <div class="righttools">
        <div id="apiPill" class="pill ng"><strong>API:</strong> æœªç¢ºèª</div>
        <button class="btn small" id="btnPing">æ¥ç¶šãƒã‚§ãƒƒã‚¯</button>
        <button class="btn small" id="btnReset">ãƒªã‚»ãƒƒãƒˆ</button>
      </div>
    </div>
  </div>
</header>

<div class="wrap">
  <div class="grid">
    <div class="card">
      <h2>å‡ºå“ã‚»ãƒƒãƒˆä½œæˆ <span class="hint">ï¼ˆã“ã“ã ã‘è§¦ã‚Œã°OKï¼‰</span></h2>

      <div class="row">
        <div class="field">
          <label>ãƒ–ãƒ©ãƒ³ãƒ‰</label>
          <select id="brand">
            <option>CHANEL</option>
            <option>HERMES</option>
            <option>LOUIS VUITTON</option>
            <option>DIOR</option>
            <option>GUCCI</option>
            <option>PRADA</option>
            <option>CELINE</option>
            <option>FENDI</option>
            <option>BOTTEGA VENETA</option>
            <option>OTHERS</option>
          </select>
        </div>
        <div class="field">
          <label>ãƒ¢ãƒ‡ãƒ«ï¼ˆä¾‹ï¼šãƒãƒˆãƒ©ãƒƒã‚» / ã‚¬ãƒ¼ãƒ‡ãƒ³ãƒ‘ãƒ¼ãƒ†ã‚£ / ãƒãƒ´ã‚¡ãƒ¼ãƒ•ãƒ«ï¼‰</label>
          <input id="model" placeholder="ä¾‹ï¼šãƒãƒˆãƒ©ãƒƒã‚» 25 / ãƒ€ã‚¤ã‚¢ãƒŠ / ãƒ”ã‚³ã‚¿ãƒ³PM" />
        </div>
      </div>

      <div class="row">
        <div class="field">
          <label>è‰²</label>
          <input id="color" placeholder="ä¾‹ï¼šãƒ–ãƒ©ãƒƒã‚¯ / ã‚¨ãƒˆã‚¥ãƒ¼ãƒ— / ã‚°ãƒ¬ãƒ¼" />
        </div>
        <div class="field">
          <label>ç´ æ</label>
          <input id="material" placeholder="ä¾‹ï¼šãƒ©ãƒ ã‚¹ã‚­ãƒ³ / ã‚­ãƒ£ãƒ“ã‚¢ / ãƒˆã‚´" />
        </div>
      </div>

      <div class="field">
        <label>çŠ¶æ…‹ï¼ˆçŸ­ãï¼‰</label>
        <input id="condition" placeholder="ä¾‹ï¼šè§’ã‚¹ãƒ¬å°‘ / å‹å´©ã‚Œè»½ / å†…å´æ±šã‚Œå°‘" />
      </div>

      <div class="field">
        <label>è¿½åŠ æŒ‡ç¤ºï¼ˆå¿…è¦ãªæ™‚ã ã‘ï¼‰</label>
        <textarea id="extra" placeholder="ä¾‹ï¼šå¯Œè£•å±¤å‘ã‘ / æµ·å¤–å‘ã‘ / èƒŒæ™¯ã¯é«˜ç´šãƒ›ãƒ†ãƒ«ãƒ©ã‚¦ãƒ³ã‚¸é¢¨ï¼ˆâ€»å•†å“ã¯AIã«æã‹ã›ãªã„ï¼‰"></textarea>
      </div>

      <div class="row">
        <div class="field">
          <label>è²©å£²ï¼ˆæ–‡ç« ã®ãƒˆãƒ¼ãƒ³è‡ªå‹•åˆ‡æ›¿ï¼‰</label>
          <select id="tone">
            <option value="mercari_fast">ãƒ¡ãƒ«ã‚«ãƒªï¼ˆå³å£²ã‚Œï¼‰</option>
            <option value="mercari_premium">ãƒ¡ãƒ«ã‚«ãƒªï¼ˆãƒ—ãƒ¬ãƒŸã‚¢å¼·ã‚ï¼‰</option>
            <option value="yahoo">ãƒ¤ãƒ•ã‚ªã‚¯</option>
            <option value="rakuma">ãƒ©ã‚¯ãƒ</option>
            <option value="b2b">BtoBï¼ˆæ¥­è€…å‘ã‘ï¼‰</option>
          </select>
        </div>
        <div class="field">
          <label>åŒæ™‚å‡ºå“ï¼ˆåŠè‡ªå‹•ï¼‰</label>
          <div class="tinyBtns">
            <button class="btn small" id="openMercari">ãƒ¡ãƒ«ã‚«ãƒªã‚’é–‹ã</button>
            <button class="btn small" id="openYahoo">ãƒ¤ãƒ•ã‚ªã‚¯ã‚’é–‹ã</button>
            <button class="btn small" id="openRakuma">ãƒ©ã‚¯ãƒã‚’é–‹ã</button>
          </div>
          <div class="mini">â€» â€œé–‹ãâ€ ã ã‘ï¼ˆè‡ªå‹•æŠ•ç¨¿ã¯ã—ã¾ã›ã‚“ï¼‰</div>
        </div>
      </div>

      <div class="actions">
        <button class="btn primary" id="btnAll">â‘  ç”»åƒï¼‹æ–‡ç«  ã¾ã¨ã‚ã¦ç”Ÿæˆ</button>
        <button class="btn" id="btnImg">ç”»åƒã ã‘</button>
        <button class="btn" id="btnText">æ–‡ç« ã ã‘</button>
      </div>

      <div class="footerNote">
        âœ… ã¾ãšã¯ <span class="kbd">æ¥ç¶šãƒã‚§ãƒƒã‚¯</span> â†’ <span class="kbd">æ–‡ç« ã ã‘</span> ã®é †ã«å‹•ä½œç¢ºèªãŒãŠã™ã™ã‚ã€‚<br/>
        ï¼ˆRender Free ã¯æœ€åˆã ã‘å°‘ã—å¾…ã¤ã“ã¨ãŒã‚ã‚Šã¾ã™ï¼‰
      </div>

      <div id="errBox" class="danger"></div>
    </div>

    <div class="card">
      <h2>ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ <span class="hint" id="statusHint">å¾…æ©Ÿä¸­</span></h2>

      <div class="idbox">
        <div>ç®¡ç†IDï¼š<span id="wmid">WM-0000</span></div>
        <button class="btn small" id="copyId">IDã‚’ã‚³ãƒ”ãƒ¼</button>
      </div>

      <div class="previewGrid">
        <div class="ph" id="ph1">
          <small>ç”»åƒï¼ˆç™½èƒŒæ™¯EC / ç”Ÿæˆå¾Œã«è¡¨ç¤ºï¼‰</small>
          <div class="muted">ã“ã“ã«è¡¨ç¤º</div>
        </div>
        <div class="ph" id="ph2">
          <small>èƒŒæ™¯ã‚¢ãƒ¬ãƒ³ã‚¸ï¼ˆå¿…è¦ãªæ™‚ã ã‘ / ç”Ÿæˆå¾Œã«è¡¨ç¤ºï¼‰</small>
          <div class="muted">ã“ã“ã«è¡¨ç¤º</div>
        </div>
      </div>

      <div style="margin-top:12px;font-weight:800;font-size:13px;color:var(--muted);">
        ç”Ÿæˆã•ã‚ŒãŸæ–‡ç« ï¼ˆã‚³ãƒ”ãƒ¼ã—ã¦å‡ºå“æ¬„ã¸ï¼‰
      </div>
      <div id="textOut" class="textout">ã“ã“ã«æ–‡ç« ãŒå‡ºã¾ã™</div>

      <div class="actions">
        <button class="btn" id="copyText">æ–‡ç« ã‚’ã‚³ãƒ”ãƒ¼</button>
      </div>

      <div class="mini">
        ğŸ”§ ã†ã¾ãã„ã‹ãªã„æ™‚ã¯ã€Œã‚¨ãƒ©ãƒ¼ã®èµ¤ã„ç®±ã€ã« â€œæœ¬å½“ã®åŸå› â€ ã‚’å‡ºã™ã‚ˆã†ã«ã—ã¦ã‚ã‚Šã¾ã™ã€‚<br/>
        ãã‚Œã‚’ãã®ã¾ã¾è²¼ã£ã¦ãã‚Œã‚Œã°ä¸€ç™ºã§ç›´ã›ã¾ã™ã€‚
      </div>
    </div>
  </div>

  <div class="card" style="margin-top:18px">
    <h2>å£²ã‚ŒãŸé€šçŸ¥ï¼ˆv1.0ï¼šæ‰‹å‹•ç™»éŒ² â†’ å–ã‚Šæ¶ˆã—ã ã‘æœ€çŸ­ï¼‰ <span class="hint">ï¼ˆä»Šã¯æœªå®Ÿè£…ã§ã‚‚OKï¼‰</span></h2>
    <div class="mini">
      v1.0 ã§ã¯ â€œå£²ã‚ŒãŸã‚‰å–ã‚Šæ¶ˆã—â€ ã‚’æœ€çŸ­ã§å…¥ã‚Œã‚‹ãŸã‚ã€ã¾ãšã¯åœŸå°ã ã‘ç½®ã„ã¦ã‚ã‚Šã¾ã™ã€‚<br/>
      ï¼ˆã“ã“ã¯å¾Œã§ä¸€æ°—ã«ä½œã‚Šã¾ã™ï¼‰
    </div>
  </div>
</div>

<script>
/**
 * âœ… ã“ã“ã ã‘è¶…é‡è¦
 * ã‚ãªãŸã® API ã® URLï¼ˆä»Šå‹•ã„ã¦ã‚‹ã‚„ã¤ï¼‰
 */
const API_BASE = "https://whitemuse-api.onrender.com"; // â† ã“ã‚Œã§å›ºå®š

// ---------- helpers ----------
const $ = (id) => document.getElementById(id);
const apiPill = $("apiPill");
const errBox = $("errBox");
const statusHint = $("statusHint");
const textOut = $("textOut");
const ph1 = $("ph1");
const ph2 = $("ph2");

function showErr(msg){
  errBox.style.display = "block";
  errBox.textContent = msg;
}
function clearErr(){
  errBox.style.display = "none";
  errBox.textContent = "";
}
function setHint(t){ statusHint.textContent = t; }

function newId(){
  const n = Math.floor(Math.random()*9000)+1000;
  return "WM-" + n;
}
function setId(id){ $("wmid").textContent = id; }

function resetUI(){
  clearErr();
  setHint("å¾…æ©Ÿä¸­");
  textOut.textContent = "ã“ã“ã«æ–‡ç« ãŒå‡ºã¾ã™";
  ph1.innerHTML = '<small>ç”»åƒï¼ˆç™½èƒŒæ™¯EC / ç”Ÿæˆå¾Œã«è¡¨ç¤ºï¼‰</small><div class="muted">ã“ã“ã«è¡¨ç¤º</div>';
  ph2.innerHTML = '<small>èƒŒæ™¯ã‚¢ãƒ¬ãƒ³ã‚¸ï¼ˆå¿…è¦ãªæ™‚ã ã‘ / ç”Ÿæˆå¾Œã«è¡¨ç¤ºï¼‰</small><div class="muted">ã“ã“ã«è¡¨ç¤º</div>';
  setId(newId());
}

function payload(){
  return {
    id: $("wmid").textContent,
    brand: $("brand").value,
    model: $("model").value.trim(),
    color: $("color").value.trim(),
    material: $("material").value.trim(),
    condition: $("condition").value.trim(),
    extra: $("extra").value.trim(),
    tone: $("tone").value
  };
}

/**
 * âœ… â€œã©ã®APIãƒ‘ã‚¹ãŒæ­£è§£ã‹â€ ãŒã‚ºãƒ¬ã¦ã‚‚å‹•ãã‚ˆã†ã«ã€
 * ã„ãã¤ã‹ã®å€™è£œã‚’é †ç•ªã«è©¦ã—ã¾ã™ã€‚
 */
async function postWithFallback(paths, bodyObj){
  let lastErr = null;

  for (const p of paths){
    const url = API_BASE.replace(/\/$/,"") + p;
    try{
      const res = await fetch(url, {
        method:"POST",
        headers:{ "Content-Type":"application/json" },
        body: JSON.stringify(bodyObj)
      });

      // 404/405 ã¯ã€Œãã®ãƒ‘ã‚¹ãŒç„¡ã„ã€å¯èƒ½æ€§ãŒé«˜ã„ã®ã§æ¬¡ã¸
      if (res.status === 404 || res.status === 405){
        lastErr = new Error(`Not found: ${p} (${res.status})`);
        continue;
      }

      const text = await res.text();
      let json = null;
      try{ json = JSON.parse(text); }catch(e){}

      if (!res.ok){
        // 200ä»¥å¤–ã®æ™‚ã¯è©³ç´°ã‚’å‡ºã™
        throw new Error(`HTTP ${res.status} @ ${p}\n` + (json ? JSON.stringify(json,null,2) : text));
      }

      // æˆåŠŸï¼ˆJSONã§è¿”ã‚Œã°JSONã€æ–‡å­—ãªã‚‰æ–‡å­—ï¼‰
      return json ?? { ok:true, raw:text };

    }catch(e){
      lastErr = e;
      continue;
    }
  }

  throw lastErr ?? new Error("API call failed");
}

/** GET ç¢ºèªï¼ˆ/ ã¨ /health ã‚’è©¦ã™ï¼‰ */
async function ping(){
  clearErr();
  apiPill.className = "pill ng";
  apiPill.innerHTML = "<strong>API:</strong> ç¢ºèªä¸­â€¦";

  const candidates = ["/", "/health", "/ping"];
  let ok = false;
  let last = null;

  for (const p of candidates){
    const url = API_BASE.replace(/\/$/,"") + p;
    try{
      const res = await fetch(url, { method:"GET" });
      const t = await res.text();
      if (res.ok){
        ok = true;
        // â€œWhiteMuse API is runningâ€ ã§ã‚‚OK
        break;
      } else {
        last = `HTTP ${res.status} @ ${p}\n${t}`;
      }
    }catch(e){
      last = String(e);
    }
  }

  if (ok){
    apiPill.className = "pill ok";
    apiPill.innerHTML = "<strong>API:</strong> OK";
    return true;
  }else{
    apiPill.className = "pill ng";
    apiPill.innerHTML = "<strong>API:</strong> NG";
    showErr("APIã«æ¥ç¶šã§ãã¾ã›ã‚“ã€‚\n\n" +
      "ãƒ»Render Free ã ã¨èµ·å‹•ã«æœ€å¤§50ç§’ã‹ã‹ã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™\n" +
      "ãƒ»å°‘ã—å¾…ã£ã¦ã‹ã‚‰ã‚‚ã†ä¸€åº¦ã€Œæ¥ç¶šãƒã‚§ãƒƒã‚¯ã€\n\n" +
      (last ? ("---- è©³ç´° ----\n"+last) : "")
    );
    return false;
  }
}

function setImage(el, url){
  el.innerHTML = '<small>è¡¨ç¤ºä¸­</small><img alt="" />';
  el.querySelector("img").src = url;
}

// ---------- actions ----------
async function runText(){
  clearErr();
  setHint("æ–‡ç« ç”Ÿæˆä¸­â€¦ï¼ˆå°‘ã—å¾…ã£ã¦OKï¼‰");

  // æ–‡ç« ç”Ÿæˆã®å€™è£œãƒ‘ã‚¹
  const paths = [
    "/generate/text",
    "/text",
    "/generateText",
    "/api/generate/text",
    "/api/text",
    "/generate"
  ];

  const data = await postWithFallback(paths, { ...payload(), mode:"text" });

  // ã‚ˆãã‚ã‚‹è¿”ã—æ–¹ã‚’å¸å
  const out =
    data.text ||
    data.description ||
    data.result ||
    (data.raw ? String(data.raw) : "");

  if (!out) throw new Error("æ–‡ç« ãŒç©ºã§è¿”ã£ã¦ãã¾ã—ãŸï¼ˆAPIã®è¿”å´å½¢å¼ãŒé•ã†å¯èƒ½æ€§ï¼‰\n" + JSON.stringify(data,null,2));

  textOut.textContent = out;
  setHint("æ–‡ç« ç”Ÿæˆï¼šå®Œäº† âœ…");
}

async function runImage(){
  clearErr();
  setHint("ç”»åƒç”Ÿæˆä¸­â€¦ï¼ˆæœ€åˆã ã‘å°‘ã—å¾…ã¤ã“ã¨ãŒã‚ã‚Šã¾ã™ï¼‰");

  // ç”»åƒç”Ÿæˆã®å€™è£œãƒ‘ã‚¹
  const paths = [
    "/generate/image",
    "/image",
    "/generateImage",
    "/api/generate/image",
    "/api/image",
    "/generate"
  ];

  const data = await postWithFallback(paths, { ...payload(), mode:"image" });

  // è¿”å´å€™è£œ
  const img1 = data.imageUrl || data.image_url || (data.images && data.images[0]) || data.image;
  const img2 = data.bgUrl || data.bg_url || (data.images && data.images[1]) || data.background;

  if (!img1){
    throw new Error("ç”»åƒURLãŒè¿”ã£ã¦ãã¾ã›ã‚“ã§ã—ãŸï¼ˆAPIã®è¿”å´å½¢å¼ãŒé•ã†å¯èƒ½æ€§ï¼‰\n" + JSON.stringify(data,null,2));
  }

  setImage(ph1, img1);
  if (img2) setImage(ph2, img2);

  setHint("ç”»åƒç”Ÿæˆï¼šå®Œäº† âœ…");
}

async function runAll(){
  clearErr();
  setHint("ã¾ã¨ã‚ã¦ç”Ÿæˆä¸­â€¦ï¼ˆå°‘ã—å¾…ã£ã¦OKï¼‰");

  // ã¾ã¨ã‚ç”Ÿæˆã®å€™è£œãƒ‘ã‚¹
  const paths = [
    "/generate/all",
    "/generate/bundle",
    "/bundle",
    "/all",
    "/generateAll",
    "/api/generate/all",
    "/api/bundle",
    "/generate"
  ];

  const data = await postWithFallback(paths, { ...payload(), mode:"all" });

  const out =
    data.text ||
    data.description ||
    data.resultText ||
    data.result ||
    "";

  const img1 = data.imageUrl || data.image_url || (data.images && data.images[0]) || data.image;
  const img2 = data.bgUrl || data.bg_url || (data.images && data.images[1]) || data.background;

  if (out) textOut.textContent = out;
  if (img1) setImage(ph1, img1);
  if (img2) setImage(ph2, img2);

  // ã©ã£ã¡ã‚‚ç„¡ã„ã¨ãã¯ã‚¨ãƒ©ãƒ¼
  if (!out && !img1){
    throw new Error("æ–‡ç« ã‚‚ç”»åƒã‚‚è¿”ã£ã¦ãã¾ã›ã‚“ã§ã—ãŸï¼ˆAPIã®è¿”å´å½¢å¼ãŒé•ã†å¯èƒ½æ€§ï¼‰\n" + JSON.stringify(data,null,2));
  }

  setHint("ã¾ã¨ã‚ã¦ç”Ÿæˆï¼šå®Œäº† âœ…");
}

function copyToClipboard(txt){
  navigator.clipboard.writeText(txt).catch(()=>{});
}

// ---------- wire ----------
$("btnReset").addEventListener("click", resetUI);
$("btnPing").addEventListener("click", ping);

$("btnText").addEventListener("click", async ()=>{
  try{
    const ok = await ping();
    if(!ok) return;
    await runText();
  }catch(e){
    showErr("æ–‡ç« ç”Ÿæˆã«å¤±æ•—ã—ã¾ã—ãŸã€‚\n\n---- è©³ç´° ----\n" + (e && e.message ? e.message : String(e)));
    setHint("ã‚¨ãƒ©ãƒ¼");
  }
});

$("btnImg").addEventListener("click", async ()=>{
  try{
    const ok = await ping();
    if(!ok) return;
    await runImage();
  }catch(e){
    showErr("ç”»åƒç”Ÿæˆã«å¤±æ•—ã—ã¾ã—ãŸã€‚\n\n---- è©³ç´° ----\n" + (e && e.message ? e.message : String(e)));
    setHint("ã‚¨ãƒ©ãƒ¼");
  }
});

$("btnAll").addEventListener("click", async ()=>{
  try{
    const ok = await ping();
    if(!ok) return;
    await runAll();
  }catch(e){
    showErr("ã¾ã¨ã‚ã¦ç”Ÿæˆã«å¤±æ•—ã—ã¾ã—ãŸã€‚\n\n---- è©³ç´° ----\n" + (e && e.message ? e.message : String(e)));
    setHint("ã‚¨ãƒ©ãƒ¼");
  }
});

$("copyText").addEventListener("click", ()=>{
  copyToClipboard(textOut.textContent || "");
  setHint("æ–‡ç« ã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ âœ…");
  setTimeout(()=>setHint("å¾…æ©Ÿä¸­"), 900);
});
$("copyId").addEventListener("click", ()=>{
  copyToClipboard($("wmid").textContent || "");
  setHint("IDã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ âœ…");
  setTimeout(()=>setHint("å¾…æ©Ÿä¸­"), 900);
});

$("openMercari").addEventListener("click", ()=>window.open("https://www.mercari.com/jp/sell/", "_blank"));
$("openYahoo").addEventListener("click", ()=>window.open("https://auctions.yahoo.co.jp/sell/jp/show/top", "_blank"));
$("openRakuma").addEventListener("click", ()=>window.open("https://fril.jp/sell", "_blank"));

// åˆæœŸåŒ–
resetUI();
// æœ€åˆã«ä¸€åº¦ã ã‘è‡ªå‹•ã§æ¥ç¶šãƒã‚§ãƒƒã‚¯ï¼ˆRenderãŒå¯ã¦ãŸã‚‰èµ·ãã‚‹ï¼‰
setTimeout(()=>{ ping(); }, 400);
</script>
</body>
</html>
